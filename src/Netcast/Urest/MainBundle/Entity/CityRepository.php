<?php

namespace Netcast\Urest\MainBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * CityRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CityRepository extends EntityRepository
{
    public function search($term,$lang)
    {
        $qb = $this->createQueryBuilder('city')
            ->select(['content.title','country.id','c_content.title as ct','city.id as ci'])
            ->join('city.region', 'region')
            ->join('region.country', 'country', 'WITH', 'region.country = country.id')
            ->join('country.country_content', 'content', 'WITH', 'content.lang = :lang')
            ->join('city.city_content', 'c_content', 'WITH', 'c_content.lang = :lang')
            ->where('c_content.title LIKE :term')
            ->setParameter('lang', $lang)
            ->setParameter('term', '%'.$term.'%')
        ;
        return $qb->getQuery()->getResult();

    }
}
